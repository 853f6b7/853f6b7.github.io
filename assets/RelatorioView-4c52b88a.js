import{T as I,V as C,E as S,_ as y,c as _,J as B,d as L,a as k}from"./EmptyState-b6c8762c.js";import{h as D,r as p,o as r,c as m,b as o,a as i,w as l,g as d,F as b,i as R,d as v,e as V,n as G,E as P,t as w,p as z,j as N}from"./index-e069fba1.js";import"./axios-4a70c6fc.js";const F={class:"container-vml"},$={class:"vml-lista-container"},A={class:"lista"},E={class:"calendario"},O=["disabled"],U={key:0,class:"pagination"},M={class:"items-pagination"},j=["src"],q={class:"dialog-footer"},J={data:()=>({user:JSON.parse(localStorage.getItem("user")),vmls:[],starDate:new Date,endDate:new Date,registros:10,pagina:1,totalPaginas:null,selects:[],selectedBusiness:[],dialogVisible:!1,imgView:null,listaClientes:[],loading:!0,defaultURL:"https://apiportalmultilixo.azurewebsites.net"}),created(){const{id:t}=this.user;_.Get(`${this.defaultURL}/Usuario/`+t).then(e=>{this.user.idgruposclientes=e.data.idGruposClientes,this.mountGrid()})},watch:{pagina(){this.mountGrid()},endDate(){this.mountGrid()}},methods:{formatData:t=>new Date(t).toLocaleString([],{dateStyle:"short"}),setPage(t){this.pagina=t},downloadAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=B();this.selects.forEach(s=>{e.file(t+s.pathImagem,"hello world")}),e.generateAsync({type:"blob"}).then(s=>{const n=new Blob([s]);L(n,"meu.zip")})},downloadItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;this.imgView=e,this.dialogVisible=!0},changeFilterBusiness(t){this.selectedBusiness=t},changeDates({start:t,end:e}){this.starDate=new Date(t),this.endDate=new Date(e)},selectItem(t,e){e?this.selects.push(t):this.selects=this.selects.filter(s=>s!=t)},setLoading(t){const e=P.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close(),this.selects=[]},mountGrid(){const{idgruposclientes:t,role:e}=this.user,{pagina:s,registros:n,selectedBusiness:c,defaultURL:g,setLoading:u}=this;u(!0),_.Get(`${g}/Cliente/grupo/`+t).then(h=>{const a={vrl:0,pagina:s,registros:n,datainicial:this.starDate.toISOString(),datafinal:this.endDate.toISOString(),idgruposclientes:t,versao:2,listaclientes:h.data};c?a.listaclientes=[c]:e=="Admin"&&(a.listaclientes=[]),_.Post("https://apiportalmultilixo.azurewebsites.net/Vrls/periodo",a).then(f=>{this.totalPaginas=f.data.total_registros,this.vmls=f.data.registros,u(!1)}).catch(()=>{u(!1),this.vmls=[]})})}}},T=Object.assign(J,{__name:"RelatorioMedicao",setup(t){return(e,s)=>{const n=p("el-col"),c=p("el-row"),g=p("el-pagination"),u=p("el-button"),h=p("el-dialog");return r(),m(b,null,[o(I,{title:"Relatórios"}),o(C,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:this.idgruposclientes,background:"#543976"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes"]),i("div",F,[i("div",$,[i("div",A,[o(c,null,{default:l(()=>[o(n,{span:1}),o(n,{span:11},{default:l(()=>[d("Nome")]),_:1}),o(n,{span:4},{default:l(()=>[d("VML")]),_:1}),o(n,{span:4},{default:l(()=>[d("Data")]),_:1}),o(n,{span:4},{default:l(()=>[d("Ações")]),_:1})]),_:1}),(r(!0),m(b,null,R(e.vmls,a=>(r(),v(k,{selectItem:e.selectItem,idVrls:a.idVrls,actionDownload:e.downloadItem,actionView:e.viewItem,data:a},{cnpj:l(()=>[d(w(a.nomeLocal!=""?a.nomeLocal:a.nome),1)]),vml:l(()=>[d(w(a.vrl),1)]),data:l(()=>[d(w(e.formatData(a.dataBaixa)),1)]),_:2},1032,["selectItem","idVrls","actionDownload","actionView","data"]))),256)),e.vmls.length===0?(r(),v(S,{key:0,message:"Nenhum VML encontrado"})):V("",!0)]),i("div",E,[o(c,null,{default:l(()=>[o(n,{span:12},{default:l(()=>[i("button",{class:G([{"button-download":!0,"button-download-active":e.selects.length>0},"button-download"]),disabled:e.selects.length==0,onClick:s[0]||(s[0]=a=>e.downloadAllSelected())}," DOWNLOAD",10,O)]),_:1})]),_:1}),o(y,{changeDates:e.changeDates},null,8,["changeDates"])])]),e.vmls.length>0?(r(),m("div",U,[i("div",M,[o(g,{background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":s[1]||(s[1]=a=>e.page=a),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):V("",!0),o(h,{modelValue:e.dialogVisible,"onUpdate:modelValue":s[3]||(s[3]=a=>e.dialogVisible=a),width:"80%","before-close":e.handleClose},{footer:l(()=>[i("span",q,[o(u,{onClick:s[2]||(s[2]=a=>e.dialogVisible=!1)},{default:l(()=>[d("Fechar")]),_:1})])]),default:l(()=>[i("img",{src:e.imgView,style:{width:"100%"}},null,8,j)]),_:1},8,["modelValue","before-close"])])],64)}}}),H=D(T,[["__scopeId","data-v-4febc74a"]]);const W=t=>(z("data-v-739a9a0f"),t=t(),N(),t),Z=W(()=>i("div",{class:"breadcumbs"},[i("div",{class:"home"},"Home"),i("div",{class:"ordens-service-vml"},"Relatórios")],-1)),K={__name:"RelatorioView",setup(t){return(e,s)=>(r(),m("div",null,[Z,i("div",null,[o(H)])]))}},x=D(K,[["__scopeId","data-v-739a9a0f"]]);export{x as default};
