import{_ as F,r as f,o as g,l as M,w as i,b as l,q as v,f as E,a as m,x as N,u as I,y as S,p as z,i as U,c as _,n as L,h as p,C as G,F as V,k as C,d as $,t as b,m as A,e as w,D,E as O}from"./index-e83532d8.js";import{V as j}from"./VisualizarArquivoVml-b831c0f0.js";import{_ as R}from"./VmlPesquisa-cd592109.js";import{J as k,d as B}from"./file-download-d0c7ce28.js";import{T as J,E as Z}from"./EmptyState-139be1ce.js";import{E as H}from"./jspdf.es.min-807502bb.js";import{B as K}from"./Breadcumbs-a42f76dd.js";/* empty css                                                    */const q=t=>(z("data-v-b99cb41c"),t=t(),U(),t),Q=["value"],W=q(()=>m("div",{class:"texto-botao"},"Visualizar",-1)),X=q(()=>m("div",{class:"texto-botao"},"Download",-1)),Y={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},selects:{type:Array,default:()=>[]},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)},selects(t){t.length===0&&(this.selected=!1)}},methods:{zerarCheckboxes(){}}},x=Object.assign(Y,{__name:"VmlItem",setup(t){return(e,a)=>{const s=f("el-col"),o=f("el-button"),d=f("el-row");return g(),M(d,null,{default:i(()=>[l(s,{span:1},{default:i(()=>[v(e.$slots,"check",{class:"nome"},()=>[E(m("input",{type:"checkbox",value:e.selected,"onUpdate:modelValue":a[0]||(a[0]=n=>e.selected=n)},null,8,Q),[[N,e.selected]])],!0)]),_:3}),l(s,{span:3},{default:i(()=>[v(e.$slots,"codCliente",{class:"nome"},void 0,!0)]),_:3}),l(s,{span:9},{default:i(()=>[v(e.$slots,"cnpj",{class:"nome"},void 0,!0)]),_:3}),l(s,{span:4},{default:i(()=>[v(e.$slots,"vml",{},void 0,!0)]),_:3}),l(s,{span:3},{default:i(()=>[v(e.$slots,"data",{},void 0,!0)]),_:3}),l(s,{span:4},{default:i(()=>[m("div",null,[l(o,{icon:j,onClick:a[1]||(a[1]=n=>e.$props.actionView(e.$props.data))},{default:i(()=>[W]),_:1}),l(o,{icon:I(S),onClick:a[2]||(a[2]=n=>e.$props.actionDownload(e.$props.data))},{default:i(()=>[X]),_:1},8,["icon"])])]),_:1})]),_:3})}}}),ee=F(x,[["__scopeId","data-v-b99cb41c"]]);const te={class:"datepicker"},ae={watch:{range:{deep:!0,handler({start:s,end:d}){var a=new Date(s);a.setUTCHours(0,0,0,0),a.setUTCDate(a.getUTCDate());var s=a.toISOString(),o=new Date(d);o.setUTCHours(0,0,0,0),o.setUTCDate(o.getUTCDate());var d=o.toISOString();this.$props.changeDates({start:s,end:d},!0)}}},props:{changeDates:{type:Function,default:()=>{}}},data(){var t=new Date;return t.setDate(t.getDate()-5),{range:{start:t,end:new Date},selectedColor:"teal"}}},se=Object.assign(ae,{__name:"VmlCalendario",setup(t){return(e,a)=>{const s=f("VDatePicker");return g(),_("div",te,[l(s,{modelValue:e.range,"onUpdate:modelValue":a[0]||(a[0]=o=>e.range=o),modelModifiers:{range:!0},color:e.selectedColor,attributes:e.attributes,borderless:"",transparent:""},null,8,["modelValue","color","attributes"])])}}});const y=t=>(z("data-v-cabab138"),t=t(),U(),t),oe={class:"container-vml"},le={class:"vml-lista-container"},ne={class:"calendario"},ie=y(()=>m("br",null,null,-1)),re={class:"lista"},de={key:0,class:"pagination"},ce={class:"items-pagination"},ue={id:"images"},pe=["src"],me=y(()=>m("span",{class:"dialog-footer"},[m("div",{class:"container-bt-imprimir"})],-1)),ge={key:0,class:"progresso"},he=y(()=>m("br",null,null,-1)),fe=y(()=>m("br",null,null,-1)),_e={class:"infinite-list-wrapper"},be={data:()=>({user:JSON.parse(sessionStorage.getItem("user")),vmls:[],starDate:new Date,endDate:new Date,registros:10,pagina:1,totalPaginas:0,selects:[],selectedBusiness:[],dialogVisible:!1,imgView:null,listaClientes:[],loading:!0,idgruposclientes:null,imagens:null,downloadAllVisible:!1,loadingActive:!1,progresso:!1,qtdeDocs:0,prctDocs:0,errorDocs:[],periodoData:null}),created(){this.mountGrid()},watch:{endDate(){this.pagina=1,this.mountGrid()}},methods:{formatData:t=>new Date(t).toLocaleString([],{dateStyle:"short"}),setPage(t){this.selects=[],this.pagina=t,this.mountGrid()},catchDefault(t){console.error(t),this.setLoading(!1)},openAllDownloadPopup(){this.loadingActive||(this.qtdeDocs=0,this.prctDocs=0,this.errorDocs=[],this.progresso=!1),this.downloadAllVisible=!0},async downloadAll(){this.loadingActive=!0,this.progresso=!0;let t=[],e="",a=!1;this.qtdeDocs=0,this.prctDocs=0,this.errorDocs=[];const{__BLOBAPI:s,__API:o}=this,d=function(r){var h=new Blob([r.data],{type:"image/gif"});t.push({name:r.request.responseURL.replace(s,""),file:h})},n=function(r){r.response.status==404&&(e=r.request.responseURL,a=!0)};this.periodoData.registros=this.totalPaginas;let u=await A.Post(`${o}/Vrls/periodo`,this.periodoData).catch(r=>console.error(r));if(u.status!=200){console.error(u);return}for(let r=0;r<u.data.registros.length;r++){if(u.data.registros[r].lstPathImagem.length>0)for(let h=0;h<u.data.registros[r].lstPathImagem.length;h++)await this.downloadVml(s+u.data.registros[r].lstPathImagem[h].pathImage).then(d).catch(n);else await this.downloadVml(s+u.data.registros[r].pathImagem).then(d).catch(n);a?(a=!1,this.errorDocs.push(`Erro: VML não encontrado - ${e.replace(s,"")}`)):(this.qtdeDocs++,this.prctDocs=Math.round(100*this.qtdeDocs/u.data.registros.length))}t.length>0&&this.createAndDownloadZipFile(t),this.loadingActive=!1},createAndDownloadZipFile(t){const e=k();t.forEach(a=>{e.file(a.name,a.file)}),e.generateAsync({type:"blob"}).then(a=>{const s=new Blob([a]);B(s,"TodosVMLsPortalMultilixo.zip"),this.setLoading(!1)})},downloadVml(t){return w.get(t,{responseType:"blob"})},async ViewAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=new H;this.setLoading(!0);let a=0;await this.selects.reduce(async(s,o,d)=>{await s,o.lstPathImagem.length>0?await o.lstPathImagem.reduce(async(n,u)=>{await w.get(t+u.pathImage,{responseType:"blob"}).then(()=>{var r=new Image;r.src=t+u.pathImage,e.addImage(r,"GIF",10,5,0,100),e.addPage(),a++}).catch(this.catchDefault)},Promise.resolve()):await w.get(t+o.pathImagem,{responseType:"blob"}).then(()=>{var n=new Image;n.src=t+o.pathImagem,d!=0&&e.addPage(),e.addImage(n,"GIF",10,5,130,100),a++}).catch(this.catchDefault)},Promise.resolve()),this.setLoading(!1),a>0?window.open(e.output("bloburl")):D.alert("Nenhuma imagem encontrada","VML")},async downloadAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=k(),a=[];if(this.setLoading(!0),await this.selects.reduce(async(s,o)=>{await s,o.lstPathImagem.length>0?await o.lstPathImagem.reduce(async(d,n)=>{await d,await w.get(t+n.pathImage,{responseType:"blob"}).then(u=>{var r=new Blob([u.data],{type:"image/gif"});a.push({name:n.pathImage,file:r})}).catch(this.catchDefault)},Promise.resolve()):await w.get(t+o.pathImagem,{responseType:"blob"}).then(d=>{var n=new Blob([d.data],{type:"image/gif"});a.push({name:o.pathImagem,file:n})}).catch(this.catchDefault)},Promise.resolve()),a.length<1){this.setLoading(!1),D.alert("Nenhuma imagem encontrada","VML");return}a.forEach(s=>{e.file(s.name,s.file)}),e.generateAsync({type:"blob"}).then(s=>{const o=new Blob([s]);this.setLoading(!1),B(o,"VMLsPortalMultilixo.zip")})},async downloadItem(t){if(this.setLoading(!0),t.lstPathImagem.length>0){const a="https://portalmultilixo.blob.core.windows.net/portalmultilixo",s=k(),o=[];if(await t.lstPathImagem.reduce(async(d,n)=>{await d,await w.get(a+n.pathImage,{responseType:"blob"}).then(u=>{var r=new Blob([u.data],{type:"image/gif"});o.push({name:n.pathImage,file:r})}).catch(this.catchDefault)},Promise.resolve()),o.length<1){this.setLoading(!1),D.alert("Nenhuma imagem encontrada","VML");return}o.forEach(d=>{s.file(d.name,d.file)}),s.generateAsync({type:"blob"}).then(d=>{const n=new Blob([d]);B(n,"VMLsPortalMultilixo.zip"),this.setLoading(!1)});return}const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo";if(t.lstPathImagem.length>0){const a=[];t.lstPathImagem.forEach(s=>{a.push({src:e+s.pathImage})}),this.imagens=a,this.dialogVisible=!0;return}this.setLoading(!0),w.get(e+t.pathImagem,{responseType:"blob"}).then(a=>{var s=new Blob([a.data],{type:"image/gif"}),o=URL.createObjectURL(s);window.open(o)}).catch(a=>{console.error(a),a.response.status==404&&D.alert("Nenhuma imagem encontrada","VML")}).finally(()=>{this.setLoading(!1)})},changeFilterBusiness(t){t?this.selectedBusiness=[t]:this.selectedBusiness=[]},changeDates({start:t,end:e}){this.starDate=t,this.endDate=e,this.selects=[]},selectItem(t,e){e?this.selects.push(t):this.selects=this.selects.filter(a=>a!=t)},setLoading(t){const e=O.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close()},mountGrid(t){if(t&&this.pagina!=1){this.pagina=t,this.totalPaginas=t;return}const{idGruposClientes:e,role:a,id:s}=this.user,{pagina:o,registros:d,selectedBusiness:n,__API:u,setLoading:r}=this;r(!0);let h=null;a=="Admin"?h=`${u}/Cliente/grupo/`+e:h=`${u}/Usuario/acessos/`+s,A.Get(h).then(P=>{const c={vrl:0,pagina:o,registros:d,datainicial:this.starDate,datafinal:this.endDate,idgruposclientes:e,versao:2,listaclientes:P.data};n.length>0?c.listaclientes=n:a=="Admin"&&(c.listaclientes=[]),this.periodoData=c,A.Post(`${u}/Vrls/periodo`,c).then(T=>{this.totalPaginas=T.data.total_registros,this.vmls=T.data.registros,r(!1)}).catch(()=>{r(!1),this.totalPaginas=0,this.vmls=[]})})}}},we=Object.assign(be,{__name:"VmlLista",setup(t){return(e,a)=>{const s=f("el-button"),o=f("el-badge"),d=f("el-button-group"),n=f("el-col"),u=f("el-row"),r=f("el-pagination"),h=f("el-dialog"),P=f("el-progress");return g(),_(V,null,[l(J,{title:"Ordens de servico VML"}),l(R,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#F08327"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes"]),m("div",oe,[m("div",le,[m("div",ne,[l(d,{class:"button-download-container"},{default:i(()=>[l(s,{icon:I(S),class:L([{"":!0,"button-download-active":e.selects.length>0},"button-download"]),disabled:e.selects.length==0,onClick:a[0]||(a[0]=c=>e.downloadAllSelected())},{default:i(()=>[p(" Download ")]),_:1},8,["icon","class","disabled"]),l(s,{icon:I(G),class:L([{"":!0,"button-download-active":e.selects.length>0},"button-download"]),disabled:e.selects.length==0,onClick:a[1]||(a[1]=c=>e.ViewAllSelected())},{default:i(()=>[p("Visualizar ")]),_:1},8,["icon","class","disabled"]),ie,l(o,{value:e.totalPaginas,max:9999,style:{width:"100%"}},{default:i(()=>[l(s,{icon:I(S),class:L([{"":!0,"button-download-active":e.totalPaginas>0},"button-download-all"]),disabled:e.totalPaginas<1,onClick:e.openAllDownloadPopup},{default:i(()=>[p(" Download todos VMLs ")]),_:1},8,["icon","class","disabled","onClick"])]),_:1},8,["value"])]),_:1}),l(se,{changeDates:e.changeDates},null,8,["changeDates"])]),m("div",re,[l(u,{class:"lista-header"},{default:i(()=>[l(n,{span:1}),l(n,{span:3},{default:i(()=>[p("Cliente")]),_:1}),l(n,{span:9},{default:i(()=>[p("Nome")]),_:1}),l(n,{span:4},{default:i(()=>[p("VML")]),_:1}),l(n,{span:4},{default:i(()=>[p("Data")]),_:1}),l(n,{span:3},{default:i(()=>[p("Ações")]),_:1})]),_:1}),(g(!0),_(V,null,C(e.vmls,c=>(g(),M(ee,{selectItem:e.selectItem,idVrls:c.idVrls,actionDownload:e.downloadItem,actionView:e.viewItem,data:c,selects:e.selects},{codCliente:i(()=>[p(b(c.codigoCliente),1)]),cnpj:i(()=>[p(b(c.nomeLocal!=""?c.nomeLocal:c.nome),1)]),vml:i(()=>[p(b(c.vrl),1)]),data:i(()=>[p(b(e.formatData(c.dataChamada)),1)]),_:2},1032,["selectItem","idVrls","actionDownload","actionView","data","selects"]))),256)),e.vmls.length===0?(g(),M(Z,{key:0,message:"Nenhum VML encontrado"})):$("",!0)])]),e.vmls.length>0?(g(),_("div",de,[m("div",ce,[l(r,{small:"",background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":a[2]||(a[2]=c=>e.page=c),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):$("",!0)]),l(h,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=c=>e.dialogVisible=c),width:"80%"},{footer:i(()=>[me]),default:i(()=>[m("div",ue,[(g(!0),_(V,null,C(e.imagens,c=>(g(),_("img",{src:c.src,alt:"Imagem nao encontrada",style:{width:"100%","margin-top":"40px"}},null,8,pe))),256))])]),_:1},8,["modelValue"]),l(h,{modelValue:e.downloadAllVisible,"onUpdate:modelValue":a[4]||(a[4]=c=>e.downloadAllVisible=c),width:"80%",title:"Download todos VMLs"},{footer:i(()=>[l(s,{type:"primary",class:"button-download-active button-popup",loading:e.loadingActive,onClick:e.downloadAll},{default:i(()=>[p("Download")]),_:1},8,["loading","onClick"])]),default:i(()=>[p(b(e.totalPaginas)+" VML's na pesquisa atual. ",1),e.progresso?(g(),_("div",ge,[p(" Fazendo download..."),he,p(" "+b(e.qtdeDocs)+" de "+b(e.totalPaginas)+" baixados ",1),l(P,{percentage:e.prctDocs,color:"#F08327"},null,8,["percentage"]),fe,m("div",_e,[m("ul",null,[(g(!0),_(V,null,C(e.errorDocs,c=>(g(),_("li",null,b(c),1))),256))])])])):$("",!0)]),_:1},8,["modelValue"])],64)}}}),ve=F(we,[["__scopeId","data-v-cabab138"]]);const Ve={__name:"VmlView",setup(t){return(e,a)=>(g(),_(V,null,[l(K,null,{titulo:i(()=>[p("Ordens de serviço VML")]),_:1}),l(ve)],64))}},ke=F(Ve,[["__scopeId","data-v-6601bccf"]]);export{ke as default};
