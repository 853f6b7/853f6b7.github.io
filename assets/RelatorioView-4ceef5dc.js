import{T as I,V as C,E as S,_ as y,J as B,d as k,c as b,a as P}from"./EmptyState-70b08cfc.js";import{_ as D,r as p,o as r,c as m,b as o,a as i,w as l,f as d,F as f,i as L,j as v,d as V,n as G,E as N,t as h,p as R,g as A}from"./index-32438fd7.js";import"./axios-4a70c6fc.js";const F={class:"container-vml"},$={class:"vml-lista-container"},z={class:"lista"},E={class:"calendario"},O=["disabled"],M={key:0,class:"pagination"},j={class:"items-pagination"},q=["src"],J={class:"dialog-footer"},T={data:()=>({user:JSON.parse(localStorage.getItem("user")),vmls:[],starDate:new Date,endDate:new Date,registros:10,pagina:1,totalPaginas:null,selects:[],selectedBusiness:[],dialogVisible:!1,imgView:null,listaClientes:[],loading:!0,idgruposclientes:null}),created(){this.mountGrid()},watch:{pagina(){this.mountGrid()},endDate(){this.mountGrid()}},methods:{formatData:t=>new Date(t).toLocaleString([],{dateStyle:"short"}),setPage(t){this.pagina=t},downloadAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=B();this.selects.forEach(s=>{e.file(t+s.pathImagem,"hello world")}),e.generateAsync({type:"blob"}).then(s=>{const n=new Blob([s]);k(n,"meu.zip")})},downloadItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;this.imgView=e,this.dialogVisible=!0},changeFilterBusiness(t){this.selectedBusiness=[t]},changeDates({start:t,end:e}){this.starDate=new Date(t),this.endDate=new Date(e)},selectItem(t,e){e?this.selects.push(t):this.selects=this.selects.filter(s=>s!=t)},setLoading(t){const e=N.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close(),this.selects=[]},mountGrid(){const{idGruposClientes:t,role:e}=this.user,{pagina:s,registros:n,selectedBusiness:c,__API:g,setLoading:u}=this;u(!0),b.Get(`${g}/Cliente/grupo/`+t).then(_=>{const a={vrl:0,pagina:s,registros:n,datainicial:this.starDate.toISOString(),datafinal:this.endDate.toISOString(),idgruposclientes:t,versao:2,listaclientes:_.data};c.length>0?a.listaclientes=c:e=="Admin"&&(a.listaclientes=[]),b.Post(`${g}/Vrls/periodo`,a).then(w=>{this.totalPaginas=w.data.total_registros,this.vmls=w.data.registros,u(!1)}).catch(()=>{u(!1),this.vmls=[]})})}}},U=Object.assign(T,{__name:"RelatorioMedicao",setup(t){return(e,s)=>{const n=p("el-col"),c=p("el-row"),g=p("el-pagination"),u=p("el-button"),_=p("el-dialog");return r(),m(f,null,[o(I,{title:"Relatórios"}),o(C,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#543976"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes"]),i("div",F,[i("div",$,[i("div",z,[o(c,null,{default:l(()=>[o(n,{span:1}),o(n,{span:11},{default:l(()=>[d("Nome")]),_:1}),o(n,{span:4},{default:l(()=>[d("VML")]),_:1}),o(n,{span:4},{default:l(()=>[d("Data")]),_:1}),o(n,{span:4},{default:l(()=>[d("Ações")]),_:1})]),_:1}),(r(!0),m(f,null,L(e.vmls,a=>(r(),v(P,{selectItem:e.selectItem,idVrls:a.idVrls,actionDownload:e.downloadItem,actionView:e.viewItem,data:a},{cnpj:l(()=>[d(h(a.nomeLocal!=""?a.nomeLocal:a.nome),1)]),vml:l(()=>[d(h(a.vrl),1)]),data:l(()=>[d(h(e.formatData(a.dataBaixa)),1)]),_:2},1032,["selectItem","idVrls","actionDownload","actionView","data"]))),256)),e.vmls.length===0?(r(),v(S,{key:0,message:"Nenhum VML encontrado"})):V("",!0)]),i("div",E,[o(c,null,{default:l(()=>[o(n,{span:12},{default:l(()=>[i("button",{class:G([{"button-download":!0,"button-download-active":e.selects.length>0},"button-download"]),disabled:e.selects.length==0,onClick:s[0]||(s[0]=a=>e.downloadAllSelected())}," DOWNLOAD",10,O)]),_:1})]),_:1}),o(y,{changeDates:e.changeDates},null,8,["changeDates"])])]),e.vmls.length>0?(r(),m("div",M,[i("div",j,[o(g,{background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":s[1]||(s[1]=a=>e.page=a),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):V("",!0),o(_,{modelValue:e.dialogVisible,"onUpdate:modelValue":s[3]||(s[3]=a=>e.dialogVisible=a),width:"80%","before-close":e.handleClose},{footer:l(()=>[i("span",J,[o(u,{onClick:s[2]||(s[2]=a=>e.dialogVisible=!1)},{default:l(()=>[d("Fechar")]),_:1})])]),default:l(()=>[i("img",{src:e.imgView,style:{width:"100%"}},null,8,q)]),_:1},8,["modelValue","before-close"])])],64)}}}),H=D(U,[["__scopeId","data-v-1595673b"]]);const W=t=>(R("data-v-739a9a0f"),t=t(),A(),t),Z=W(()=>i("div",{class:"breadcumbs"},[i("div",{class:"home"},"Home"),i("div",{class:"ordens-service-vml"},"Relatórios")],-1)),K={__name:"RelatorioView",setup(t){return(e,s)=>(r(),m("div",null,[Z,i("div",null,[o(H)])]))}},x=D(K,[["__scopeId","data-v-739a9a0f"]]);export{x as default};
