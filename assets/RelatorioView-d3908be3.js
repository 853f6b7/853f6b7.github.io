import{_ as v,r as m,o as u,j as w,w as a,b as n,k as g,e as N,a as i,l as L,u as V,m as F,p as D,g as P,c as f,f as p,F as $,i as j,d as I,n as E,E as O,t as h}from"./index-24e5d409.js";import{c as y}from"./controllerbase-3b2baa9b.js";import{_ as T}from"./VmlPesquisa-a776aa1c.js";import{T as U,E as q}from"./EmptyState-87c1a8f0.js";import{V as J,J as Y,d as H}from"./file-download-a1bbb51f.js";import{a as C}from"./axios-4a70c6fc.js";const k=t=>(D("data-v-a749d99c"),t=t(),P(),t),Z=["value"],K={class:"botoes-container"},Q=k(()=>i("div",{class:"texto-botao"},"Visualizar",-1)),W=k(()=>i("div",{class:"texto-botao"},"Download",-1)),X={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]},selects:{type:Array,default:()=>[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)},selects(t){t.length===0&&(this.selected=!1)}}},x=Object.assign(X,{__name:"RelatorioItem",setup(t){return(e,s)=>{const o=m("el-col"),l=m("el-button"),r=m("el-row");return u(),w(r,null,{default:a(()=>[n(o,{span:1},{default:a(()=>[g(e.$slots,"check",{class:"nome"},()=>[N(i("input",{type:"checkbox",value:e.selected,"onUpdate:modelValue":s[0]||(s[0]=c=>e.selected=c)},null,8,Z),[[L,e.selected]])],!0)]),_:3}),n(o,{span:2},{default:a(()=>[g(e.$slots,"codigocliente",{class:"nome"},void 0,!0)]),_:3}),n(o,{span:8},{default:a(()=>[g(e.$slots,"nome",{class:"nome"},void 0,!0)]),_:3}),n(o,{span:6},{default:a(()=>[g(e.$slots,"descricaoDocumento",{class:"nome"},void 0,!0)]),_:3}),n(o,{span:3},{default:a(()=>[g(e.$slots,"periodo",{},void 0,!0)]),_:3}),n(o,{span:4},{default:a(()=>[i("div",K,[n(l,{icon:J,onClick:s[1]||(s[1]=c=>e.$props.actionView(e.$props.data))},{default:a(()=>[Q]),_:1}),n(l,{icon:V(F),onClick:s[2]||(s[2]=c=>e.$props.actionDownload(e.$props.data))},{default:a(()=>[W]),_:1},8,["icon"])])]),_:1})]),_:3})}}}),ee=v(x,[["__scopeId","data-v-a749d99c"]]);const te={class:"container-vml"},oe={class:"vml-lista-container"},se={class:"lista"},ae={key:0,class:"pagination"},ne={class:"items-pagination"},le={data:()=>({user:JSON.parse(localStorage.getItem("user")),vmls:[],registros:10,pagina:1,totalPaginas:null,selectedBusiness:[],loading:!0,idgruposclientes:null,periodoInicial:new Date,periodoFinal:new Date,selecteds:[]}),created(){this.mountGrid()},watch:{pagina(){this.mountGrid()},endDate(){this.mountGrid()}},methods:{formatData:t=>`${t.substr(4,6)} /  ${t.substr(0,4)}`,setPage(t){this.selecteds=[],this.pagina=t},selectItem(t,e){e?this.selecteds.push(t):this.selecteds=this.selecteds.filter(s=>s!=t)},downloadItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},async downloadAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=Y(),s=[];await this.selecteds.reduce(async(o,l)=>{await o,await C.get(t+l.pathImagem,{responseType:"blob"}).then(r=>{var c=new Blob([r.data],{type:"image/gif"});s.push({name:l.pathImagem,file:c})})},Promise.resolve()),s.forEach(o=>{e.file(o.name,o.file)}),e.generateAsync({type:"blob"}).then(o=>{const l=new Blob([o]);H(l,"MedicoesPortalMultilixo.zip")})},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem,s={responseType:"blob"};C.get(e,s).then(o=>{var l=new Blob([o.data],{type:"application/pdf"}),r=URL.createObjectURL(l);window.open(r)})},changeFilterBusiness(t){t?this.selectedBusiness=t:this.selectedBusiness=null},changePeriodoControl({start:t,end:e}){this.periodoInicial=t,this.periodoFinal=e},setLoading(t){const e=O.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close()},mountGrid(){const{idGruposClientes:t,role:e}=this.user,{selectedBusiness:s,__API:o,setLoading:l,periodoInicial:r,periodoFinal:c,registros:d,pagina:B}=this,R=("0"+parseInt(r.getMonth()+1)).slice(-2),S=("0"+parseInt(c.getMonth()+1)).slice(-2),G=`${r.getFullYear()}${R}`,A=`${c.getFullYear()}${S}`;var _={periodoinicial:G,periodofinal:A,registros:d,pagina:B};l(!0),y.Get(`${o}/Cliente/grupo/`+t).then(M=>{const z=M.data;s?_=Object.assign(_,{idgruposclientes:s.idGruposClientes,idclientes:s.idClientes,listaclientes:[s]}):(_=Object.assign(_,{idGruposClientes:t,listaclientes:z}),e=="Admin"&&(_.listaclientes=[])),y.Post(`${o}/Medicao/periodo`,_).then(b=>{this.totalPaginas=b.data.total_registros,this.vmls=b.data.registros,l(!1)}).catch(()=>{l(!1),this.vmls=[]})})}}},ie=Object.assign(le,{__name:"RelatorioMedicao",setup(t){return(e,s)=>{const o=m("el-col"),l=m("el-row"),r=m("el-button"),c=m("el-pagination");return u(),f($,null,[n(U,{title:"Relatórios"}),n(T,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#543976",showPeriodoControl:!0,changePeriodoControl:e.changePeriodoControl,colorButton:"#F08327",colorTextButton:"#FFFFFF"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes","changePeriodoControl"]),i("div",te,[i("div",oe,[i("div",se,[n(l,{class:"lista-header"},{default:a(()=>[n(o,{span:1}),n(o,{span:2},{default:a(()=>[p("Cod")]),_:1}),n(o,{span:9},{default:a(()=>[p("Nome")]),_:1}),n(o,{span:6},{default:a(()=>[p("Descricao Documento")]),_:1}),n(o,{span:3},{default:a(()=>[p("Periodo")]),_:1}),n(o,{span:1},{default:a(()=>[p("Ações")]),_:1})]),_:1}),(u(!0),f($,null,j(e.vmls,d=>(u(),w(ee,{idVrls:d.idVrls,actionView:e.viewItem,actionDownload:e.downloadItem,selectItem:e.selectItem,data:d,selects:e.selecteds},{codigocliente:a(()=>[p(h(d.codigoCliente),1)]),nome:a(()=>[p(h(d.nome),1)]),descricaoDocumento:a(()=>[p(h(d.descricaoDocumento),1)]),periodo:a(()=>[p(h(e.formatData(d.periodo)),1)]),_:2},1032,["idVrls","actionView","actionDownload","selectItem","data","selects"]))),256)),e.vmls.length===0?(u(),w(q,{key:0,message:"Nenhum relatório encontrado"})):I("",!0)]),i("div",null,[n(r,{disabled:e.selecteds.length<1,class:E([{"button-download":!0,"button-download-active":e.selecteds.length>0},"button-download"]),icon:V(F),onClick:s[0]||(s[0]=d=>e.downloadAllSelected())},{default:a(()=>[p(" Download ")]),_:1},8,["disabled","class","icon"])])]),e.vmls.length>0?(u(),f("div",ae,[i("div",ne,[n(c,{background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":s[1]||(s[1]=d=>e.page=d),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):I("",!0)])],64)}}}),de=v(ie,[["__scopeId","data-v-ce8ec76e"]]);const re=t=>(D("data-v-06ca4290"),t=t(),P(),t),ce={style:{"padding-top":"25px"}},pe=re(()=>i("div",{class:"breadcumbs"},[i("div",{class:"home"},"Home"),i("div",{class:"ordens-service-vml"},"Relatórios")],-1)),ue={__name:"RelatorioView",setup(t){return(e,s)=>(u(),f("div",ce,[pe,i("div",null,[n(de)])]))}},ve=v(ue,[["__scopeId","data-v-06ca4290"]]);export{ve as default};
