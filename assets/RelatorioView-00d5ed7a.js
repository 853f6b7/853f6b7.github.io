import{_ as b,r as m,o as u,j as w,w as n,b as a,k as g,e as M,a as r,l as A,u as V,m as F,c as f,f as p,F as I,i as L,d as $,n as N,E as z,t as h,p as j,g as E}from"./index-586be388.js";import{c as y}from"./controllerbase-3b2baa9b.js";import{_ as O}from"./VmlPesquisa-459c2a3f.js";import{T,E as U}from"./EmptyState-9075341a.js";import{V as q,J,d as Y}from"./file-download-ec276d59.js";import{a as C}from"./axios-4a70c6fc.js";const H=["value"],Z={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)}}},K=Object.assign(Z,{__name:"RelatorioItem",setup(t){return(e,s)=>{const o=m("el-col"),l=m("el-button"),d=m("el-row");return u(),w(d,null,{default:n(()=>[a(o,{span:1},{default:n(()=>[g(e.$slots,"check",{class:"nome"},()=>[M(r("input",{type:"checkbox",value:e.selected,"onUpdate:modelValue":s[0]||(s[0]=c=>e.selected=c)},null,8,H),[[A,e.selected]])],!0)]),_:3}),a(o,{span:2},{default:n(()=>[g(e.$slots,"codigocliente",{class:"nome"},void 0,!0)]),_:3}),a(o,{span:9},{default:n(()=>[g(e.$slots,"nome",{class:"nome"},void 0,!0)]),_:3}),a(o,{span:6},{default:n(()=>[g(e.$slots,"descricaoDocumento",{class:"nome"},void 0,!0)]),_:3}),a(o,{span:3},{default:n(()=>[g(e.$slots,"periodo",{},void 0,!0)]),_:3}),a(o,{span:3},{default:n(()=>[r("div",null,[a(l,{icon:q,onClick:s[1]||(s[1]=c=>e.$props.actionView(e.$props.data))}),a(l,{icon:V(F),onClick:s[2]||(s[2]=c=>e.$props.actionDownload(e.$props.data))},null,8,["icon"])])]),_:1})]),_:3})}}}),Q=b(K,[["__scopeId","data-v-6d89fa5e"]]);const W={class:"container-vml"},X={class:"vml-lista-container"},x={class:"lista"},ee={key:0,class:"pagination"},te={class:"items-pagination"},oe={data:()=>({user:JSON.parse(localStorage.getItem("user")),vmls:[],registros:10,pagina:1,totalPaginas:null,selectedBusiness:[],loading:!0,idgruposclientes:null,periodoInicial:new Date,periodoFinal:new Date,selecteds:[]}),created(){this.mountGrid()},watch:{pagina(){this.mountGrid()},endDate(){this.mountGrid()}},methods:{formatData:t=>`${t.substr(4,6)} /  ${t.substr(0,4)}`,setPage(t){this.pagina=t},selectItem(t,e){e?this.selecteds.push(t):this.selecteds=this.selecteds.filter(s=>s!=t)},downloadItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},async downloadAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=J(),s=[];await this.selecteds.reduce(async(o,l)=>{await o,await C.get(t+l.pathImagem,{responseType:"blob"}).then(d=>{var c=new Blob([d.data],{type:"image/gif"});s.push({name:l.pathImagem,file:c})})},Promise.resolve()),s.forEach(o=>{e.file(o.name,o.file)}),e.generateAsync({type:"blob"}).then(o=>{const l=new Blob([o]);Y(l,"VMLsPortalMultilixo.zip")})},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem,s={responseType:"blob"};C.get(e,s).then(o=>{var l=new Blob([o.data],{type:"application/pdf"}),d=URL.createObjectURL(l);window.open(d)})},changeFilterBusiness(t){t?this.selectedBusiness=t:this.selectedBusiness=null},changePeriodoControl({start:t,end:e}){this.periodoInicial=t,this.periodoFinal=e},setLoading(t){const e=z.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close()},mountGrid(){const{idGruposClientes:t,role:e}=this.user,{selectedBusiness:s,__API:o,setLoading:l,periodoInicial:d,periodoFinal:c,registros:i,pagina:P}=this,k=("0"+parseInt(d.getMonth()+1)).slice(-2),B=("0"+parseInt(c.getMonth()+1)).slice(-2),D=`${d.getFullYear()}${k}`,R=`${c.getFullYear()}${B}`;var _={periodoinicial:D,periodofinal:R,registros:i,pagina:P};l(!0),y.Get(`${o}/Cliente/grupo/`+t).then(S=>{const G=S.data;s?_=Object.assign(_,{idgruposclientes:s.idGruposClientes,idclientes:s.idClientes,listaclientes:[s]}):(_=Object.assign(_,{idGruposClientes:t,listaclientes:G}),e=="Admin"&&(_.listaclientes=[])),y.Post(`${o}/Medicao/periodo`,_).then(v=>{this.totalPaginas=v.data.total_registros,this.vmls=v.data.registros,l(!1)}).catch(()=>{l(!1),this.vmls=[]})})}}},se=Object.assign(oe,{__name:"RelatorioMedicao",setup(t){return(e,s)=>{const o=m("el-col"),l=m("el-row"),d=m("el-button"),c=m("el-pagination");return u(),f(I,null,[a(T,{title:"Relatórios"}),a(O,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#543976",showPeriodoControl:!0,changePeriodoControl:e.changePeriodoControl,colorButton:"#F08327",colorTextButton:"#FFFFFF"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes","changePeriodoControl"]),r("div",W,[r("div",X,[r("div",x,[a(l,{class:"lista-header"},{default:n(()=>[a(o,{span:1}),a(o,{span:2},{default:n(()=>[p("Cod")]),_:1}),a(o,{span:9},{default:n(()=>[p("Nome")]),_:1}),a(o,{span:6},{default:n(()=>[p("Descricao Documento")]),_:1}),a(o,{span:3},{default:n(()=>[p("Periodo")]),_:1}),a(o,{span:1},{default:n(()=>[p("Ações")]),_:1})]),_:1}),(u(!0),f(I,null,L(e.vmls,i=>(u(),w(Q,{idVrls:i.idVrls,actionView:e.viewItem,actionDownload:e.downloadItem,selectItem:e.selectItem,data:i},{codigocliente:n(()=>[p(h(i.codigoCliente),1)]),nome:n(()=>[p(h(i.nome),1)]),descricaoDocumento:n(()=>[p(h(i.descricaoDocumento),1)]),periodo:n(()=>[p(h(e.formatData(i.periodo)),1)]),_:2},1032,["idVrls","actionView","actionDownload","selectItem","data"]))),256)),e.vmls.length===0?(u(),w(U,{key:0,message:"Nenhum relatório encontrado"})):$("",!0)]),r("div",null,[a(d,{disabled:e.selecteds.length<1,class:N([{"button-download":!0,"button-download-active":e.selecteds.length>0},"button-download"]),icon:V(F),onClick:s[0]||(s[0]=i=>e.downloadAllSelected())},{default:n(()=>[p(" Download ")]),_:1},8,["disabled","class","icon"])])]),e.vmls.length>0?(u(),f("div",ee,[r("div",te,[a(c,{background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":s[1]||(s[1]=i=>e.page=i),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):$("",!0)])],64)}}}),ae=b(se,[["__scopeId","data-v-cb6bab80"]]);const ne=t=>(j("data-v-06ca4290"),t=t(),E(),t),le={style:{"padding-top":"25px"}},ie=ne(()=>r("div",{class:"breadcumbs"},[r("div",{class:"home"},"Home"),r("div",{class:"ordens-service-vml"},"Relatórios")],-1)),re={__name:"RelatorioView",setup(t){return(e,s)=>(u(),f("div",le,[ie,r("div",null,[a(ae)])]))}},ge=b(re,[["__scopeId","data-v-06ca4290"]]);export{ge as default};
