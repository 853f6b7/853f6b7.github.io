import{_ as B,r as g,o as h,k,w as i,b as l,l as v,e as q,a as u,m as E,u as I,q as A,p as F,h as U,c as f,n as L,g as c,A as G,F as y,j as T,d as P,t as _,B as V,E as O}from"./index-a556a5dd.js";import{V as j}from"./VisualizarArquivoVml-29dff239.js";import{c as z}from"./controllerbase-fca99fd1.js";import{_ as R}from"./VmlPesquisa-350aecad.js";import{J as C,d as $}from"./file-download-fa785313.js";import{T as J,E as H}from"./EmptyState-379f7692.js";import{a as b}from"./axios-4a70c6fc.js";import{E as Z}from"./jspdf.es.min-937adb8c.js";import{B as K}from"./Breadcumbs-cab6ab96.js";/* empty css                                                    */const N=t=>(F("data-v-b99cb41c"),t=t(),U(),t),Q=["value"],W=N(()=>u("div",{class:"texto-botao"},"Visualizar",-1)),X=N(()=>u("div",{class:"texto-botao"},"Download",-1)),Y={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},selects:{type:Array,default:()=>[]},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)},selects(t){t.length===0&&(this.selected=!1)}},methods:{zerarCheckboxes(){}}},x=Object.assign(Y,{__name:"VmlItem",setup(t){return(e,a)=>{const o=g("el-col"),s=g("el-button"),n=g("el-row");return h(),k(n,null,{default:i(()=>[l(o,{span:1},{default:i(()=>[v(e.$slots,"check",{class:"nome"},()=>[q(u("input",{type:"checkbox",value:e.selected,"onUpdate:modelValue":a[0]||(a[0]=r=>e.selected=r)},null,8,Q),[[E,e.selected]])],!0)]),_:3}),l(o,{span:3},{default:i(()=>[v(e.$slots,"codCliente",{class:"nome"},void 0,!0)]),_:3}),l(o,{span:9},{default:i(()=>[v(e.$slots,"cnpj",{class:"nome"},void 0,!0)]),_:3}),l(o,{span:4},{default:i(()=>[v(e.$slots,"vml",{},void 0,!0)]),_:3}),l(o,{span:3},{default:i(()=>[v(e.$slots,"data",{},void 0,!0)]),_:3}),l(o,{span:4},{default:i(()=>[u("div",null,[l(s,{icon:j,onClick:a[1]||(a[1]=r=>e.$props.actionView(e.$props.data))},{default:i(()=>[W]),_:1}),l(s,{icon:I(A),onClick:a[2]||(a[2]=r=>e.$props.actionDownload(e.$props.data))},{default:i(()=>[X]),_:1},8,["icon"])])]),_:1})]),_:3})}}}),ee=B(x,[["__scopeId","data-v-b99cb41c"]]);const te={class:"datepicker"},ae={watch:{range:{deep:!0,handler({start:o,end:n}){var a=new Date(o);a.setUTCHours(0,0,0,0),a.setUTCDate(a.getUTCDate());var o=a.toISOString(),s=new Date(n);s.setUTCHours(0,0,0,0),s.setUTCDate(s.getUTCDate());var n=s.toISOString();this.$props.changeDates({start:o,end:n},!0)}}},props:{changeDates:{type:Function,default:()=>{}}},data(){var t=new Date;return t.setDate(t.getDate()-5),{range:{start:t,end:new Date},selectedColor:"teal"}}},se=Object.assign(ae,{__name:"VmlCalendario",setup(t){return(e,a)=>{const o=g("VDatePicker");return h(),f("div",te,[l(o,{modelValue:e.range,"onUpdate:modelValue":a[0]||(a[0]=s=>e.range=s),modelModifiers:{range:!0},color:e.selectedColor,attributes:e.attributes,borderless:"",transparent:""},null,8,["modelValue","color","attributes"])])}}});const M=t=>(F("data-v-b117a13a"),t=t(),U(),t),oe={class:"container-vml"},le={class:"vml-lista-container"},ne={class:"calendario"},ie=M(()=>u("br",null,null,-1)),re={class:"lista"},de={key:0,class:"pagination"},ce={class:"items-pagination"},ue={id:"images"},pe=["src"],me=M(()=>u("span",{class:"dialog-footer"},[u("div",{class:"container-bt-imprimir"})],-1)),ge={key:0,class:"progresso"},he=M(()=>u("br",null,null,-1)),fe={data:()=>({user:JSON.parse(sessionStorage.getItem("user")),vmls:[],starDate:new Date,endDate:new Date,registros:10,pagina:1,totalPaginas:0,selects:[],selectedBusiness:[],dialogVisible:!1,imgView:null,listaClientes:[],loading:!0,idgruposclientes:null,imagens:null,downloadAllVisible:!1,loadingActive:!1,progresso:!1,qtdeDocs:0,prctDocs:0}),created(){this.mountGrid()},watch:{endDate(){this.pagina=1,this.mountGrid()}},methods:{formatData:t=>new Date(t).toLocaleString([],{dateStyle:"short"}),setPage(t){this.selects=[],this.pagina=t,this.mountGrid()},catchDefault(t){console.error(t),this.setLoading(!1)},async downloadAll(){this.loadingActive=!0,this.progresso=!0;let t=[];this.qtdeDocs=0,this.prctDocs=0;const e=C();this.user;const{__BLOBAPI:a}=this,o=function(s){var n=new Blob([s.data],{type:"image/gif"});t.push({name:s.request.responseURL.replace(a,""),file:n})};for(let s=0;s<this.vmls.length;s++){if(this.vmls[s].lstPathImagem.length>0)for(let n=0;n<this.vmls[s].lstPathImagem.length;n++)await this.downloadVml(a+this.vmls[s].lstPathImagem[n].pathImage).then(o);else await this.downloadVml(a+this.vmls[s].pathImagem).then(o);this.qtdeDocs++,this.prctDocs=Math.round(100*this.qtdeDocs/this.vmls.length)}t.forEach(s=>{e.file(s.name,s.file)}),e.generateAsync({type:"blob"}).then(s=>{const n=new Blob([s]);$(n,"TodosVMLsPortalMultilixo.zip"),this.setLoading(!1)}),this.loadingActive=!1},downloadVml(t){return b.get(t,{responseType:"blob"})},async ViewAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=new Z;this.setLoading(!0);let a=0;await this.selects.reduce(async(o,s,n)=>{await o,s.lstPathImagem.length>0?await s.lstPathImagem.reduce(async(r,p)=>{await b.get(t+p.pathImage,{responseType:"blob"}).then(()=>{var m=new Image;m.src=t+p.pathImage,e.addImage(m,"GIF",10,5,0,100),e.addPage(),a++}).catch(this.catchDefault)},Promise.resolve()):await b.get(t+s.pathImagem,{responseType:"blob"}).then(()=>{var r=new Image;r.src=t+s.pathImagem,n!=0&&e.addPage(),e.addImage(r,"GIF",10,5,130,100),a++}).catch(this.catchDefault)},Promise.resolve()),this.setLoading(!1),a>0?window.open(e.output("bloburl")):V.alert("Nenhuma imagem encontrada","VML")},async downloadAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=C(),a=[];if(this.setLoading(!0),await this.selects.reduce(async(o,s)=>{await o,s.lstPathImagem.length>0?await s.lstPathImagem.reduce(async(n,r)=>{await n,await b.get(t+r.pathImage,{responseType:"blob"}).then(p=>{var m=new Blob([p.data],{type:"image/gif"});a.push({name:r.pathImage,file:m})}).catch(this.catchDefault)},Promise.resolve()):await b.get(t+s.pathImagem,{responseType:"blob"}).then(n=>{var r=new Blob([n.data],{type:"image/gif"});a.push({name:s.pathImagem,file:r})}).catch(this.catchDefault)},Promise.resolve()),a.length<1){this.setLoading(!1),V.alert("Nenhuma imagem encontrada","VML");return}a.forEach(o=>{e.file(o.name,o.file)}),e.generateAsync({type:"blob"}).then(o=>{const s=new Blob([o]);this.setLoading(!1),$(s,"VMLsPortalMultilixo.zip")})},async downloadItem(t){if(this.setLoading(!0),t.lstPathImagem.length>0){const a="https://portalmultilixo.blob.core.windows.net/portalmultilixo",o=C(),s=[];if(await t.lstPathImagem.reduce(async(n,r)=>{await n,await b.get(a+r.pathImage,{responseType:"blob"}).then(p=>{var m=new Blob([p.data],{type:"image/gif"});s.push({name:r.pathImage,file:m})}).catch(this.catchDefault)},Promise.resolve()),s.length<1){this.setLoading(!1),V.alert("Nenhuma imagem encontrada","VML");return}s.forEach(n=>{o.file(n.name,n.file)}),o.generateAsync({type:"blob"}).then(n=>{const r=new Blob([n]);$(r,"VMLsPortalMultilixo.zip"),this.setLoading(!1)});return}const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo";if(t.lstPathImagem.length>0){const a=[];t.lstPathImagem.forEach(o=>{a.push({src:e+o.pathImage})}),this.imagens=a,this.dialogVisible=!0;return}this.setLoading(!0),b.get(e+t.pathImagem,{responseType:"blob"}).then(a=>{var o=new Blob([a.data],{type:"image/gif"}),s=URL.createObjectURL(o);window.open(s)}).catch(a=>{console.error(a),a.response.status==404&&V.alert("Nenhuma imagem encontrada","VML")}).finally(()=>{this.setLoading(!1)})},changeFilterBusiness(t){t?this.selectedBusiness=[t]:this.selectedBusiness=[]},changeDates({start:t,end:e}){this.starDate=t,this.endDate=e,this.selects=[]},selectItem(t,e){e?this.selects.push(t):this.selects=this.selects.filter(a=>a!=t)},setLoading(t){const e=O.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close()},mountGrid(t){if(t&&this.pagina!=1){this.pagina=t,this.totalPaginas=t;return}const{idGruposClientes:e,role:a,id:o}=this.user,{pagina:s,registros:n,selectedBusiness:r,__API:p,setLoading:m}=this;m(!0);let w=null;a=="Admin"?w=`${p}/Cliente/grupo/`+e:w=`${p}/Usuario/acessos/`+o,z.Get(w).then(D=>{const d={vrl:0,pagina:s,registros:n,datainicial:this.starDate,datafinal:this.endDate,idgruposclientes:e,versao:2,listaclientes:D.data};r.length>0?d.listaclientes=r:a=="Admin"&&(d.listaclientes=[]),z.Post(`${p}/Vrls/periodo`,d).then(S=>{this.totalPaginas=S.data.total_registros,this.vmls=S.data.registros,m(!1)}).catch(()=>{m(!1),this.totalPaginas=0,this.vmls=[]})})}}},_e=Object.assign(fe,{__name:"VmlLista",setup(t){return(e,a)=>{const o=g("el-button"),s=g("el-badge"),n=g("el-button-group"),r=g("el-col"),p=g("el-row"),m=g("el-pagination"),w=g("el-dialog"),D=g("el-progress");return h(),f(y,null,[l(J,{title:"Ordens de servico VML"}),l(R,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#F08327"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes"]),u("div",oe,[u("div",le,[u("div",ne,[l(n,{class:"button-download-container"},{default:i(()=>[l(o,{icon:I(A),class:L([{"":!0,"button-download-active":e.selects.length>0},"button-download"]),disabled:e.selects.length==0,onClick:a[0]||(a[0]=d=>e.downloadAllSelected())},{default:i(()=>[c(" Download ")]),_:1},8,["icon","class","disabled"]),l(o,{icon:I(G),class:L([{"":!0,"button-download-active":e.selects.length>0},"button-download"]),disabled:e.selects.length==0,onClick:a[1]||(a[1]=d=>e.ViewAllSelected())},{default:i(()=>[c("Visualizar ")]),_:1},8,["icon","class","disabled"]),ie,l(s,{value:e.totalPaginas,max:9999,style:{width:"100%"}},{default:i(()=>[l(o,{icon:I(A),class:L([{"":!0,"button-download-active":e.totalPaginas>0},"button-download-all"]),disabled:e.totalPaginas<1,onClick:a[2]||(a[2]=d=>e.downloadAllVisible=!0)},{default:i(()=>[c(" Download todos VMLs ")]),_:1},8,["icon","class","disabled"])]),_:1},8,["value"])]),_:1}),l(se,{changeDates:e.changeDates},null,8,["changeDates"])]),u("div",re,[l(p,{class:"lista-header"},{default:i(()=>[l(r,{span:1}),l(r,{span:3},{default:i(()=>[c("Cliente")]),_:1}),l(r,{span:9},{default:i(()=>[c("Nome")]),_:1}),l(r,{span:4},{default:i(()=>[c("VML")]),_:1}),l(r,{span:4},{default:i(()=>[c("Data")]),_:1}),l(r,{span:3},{default:i(()=>[c("Ações")]),_:1})]),_:1}),(h(!0),f(y,null,T(e.vmls,d=>(h(),k(ee,{selectItem:e.selectItem,idVrls:d.idVrls,actionDownload:e.downloadItem,actionView:e.viewItem,data:d,selects:e.selects},{codCliente:i(()=>[c(_(d.codigoCliente),1)]),cnpj:i(()=>[c(_(d.nomeLocal!=""?d.nomeLocal:d.nome),1)]),vml:i(()=>[c(_(d.vrl),1)]),data:i(()=>[c(_(e.formatData(d.dataChamada)),1)]),_:2},1032,["selectItem","idVrls","actionDownload","actionView","data","selects"]))),256)),e.vmls.length===0?(h(),k(H,{key:0,message:"Nenhum VML encontrado"})):P("",!0)])]),e.vmls.length>0?(h(),f("div",de,[u("div",ce,[l(m,{small:"",background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":a[3]||(a[3]=d=>e.page=d),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):P("",!0)]),l(w,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[4]||(a[4]=d=>e.dialogVisible=d),width:"80%"},{footer:i(()=>[me]),default:i(()=>[u("div",ue,[(h(!0),f(y,null,T(e.imagens,d=>(h(),f("img",{src:d.src,alt:"Imagem nao encontrada",style:{width:"100%","margin-top":"40px"}},null,8,pe))),256))])]),_:1},8,["modelValue"]),l(w,{modelValue:e.downloadAllVisible,"onUpdate:modelValue":a[5]||(a[5]=d=>e.downloadAllVisible=d),width:"80%",title:"Download todos VMLs"},{footer:i(()=>[l(o,{type:"primary",class:"button-download-active button-popup",loading:e.loadingActive,onClick:e.downloadAll},{default:i(()=>[c("Download")]),_:1},8,["loading","onClick"])]),default:i(()=>[c(_(e.totalPaginas)+" VML's na pesquisa atual. ",1),e.progresso?(h(),f("div",ge,[c(" Fazendo download..."),he,c(" "+_(e.qtdeDocs)+" de "+_(e.totalPaginas)+" baixados ",1),l(D,{percentage:e.prctDocs,color:"#F08327"},null,8,["percentage"])])):P("",!0)]),_:1},8,["modelValue"])],64)}}}),be=B(_e,[["__scopeId","data-v-b117a13a"]]);const we={__name:"VmlView",setup(t){return(e,a)=>(h(),f(y,null,[l(K,null,{titulo:i(()=>[c("Ordens de serviço VML")]),_:1}),l(be)],64))}},Ae=B(we,[["__scopeId","data-v-6601bccf"]]);export{Ae as default};
