import{_ as C,r as h,o as g,k as y,w as i,b as n,l as b,e as N,a as p,m as G,u as D,q as M,p as A,h as U,c as f,n as P,g as m,A as E,F as V,j as $,d as k,B as w,E as O,t as v}from"./index-bc3a0094.js";import{V as j}from"./VisualizarArquivoVml-eb8a159f.js";import{c as B}from"./controllerbase-fca99fd1.js";import{_ as q}from"./VmlPesquisa-9c05ec7f.js";import{J as S,d as T}from"./file-download-43dcc3de.js";import{T as J,E as R}from"./EmptyState-e875a8f5.js";import{a as _}from"./axios-4a70c6fc.js";import{E as H}from"./jspdf.es.min-6f9778a4.js";import{B as Z}from"./Breadcumbs-a5548fb3.js";/* empty css                                                    */const z=t=>(A("data-v-b99cb41c"),t=t(),U(),t),K=["value"],Q=z(()=>p("div",{class:"texto-botao"},"Visualizar",-1)),W=z(()=>p("div",{class:"texto-botao"},"Download",-1)),X={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},selects:{type:Array,default:()=>[]},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)},selects(t){t.length===0&&(this.selected=!1)}},methods:{zerarCheckboxes(){}}},Y=Object.assign(X,{__name:"VmlItem",setup(t){return(e,a)=>{const s=h("el-col"),o=h("el-button"),l=h("el-row");return g(),y(l,null,{default:i(()=>[n(s,{span:1},{default:i(()=>[b(e.$slots,"check",{class:"nome"},()=>[N(p("input",{type:"checkbox",value:e.selected,"onUpdate:modelValue":a[0]||(a[0]=r=>e.selected=r)},null,8,K),[[G,e.selected]])],!0)]),_:3}),n(s,{span:3},{default:i(()=>[b(e.$slots,"codCliente",{class:"nome"},void 0,!0)]),_:3}),n(s,{span:9},{default:i(()=>[b(e.$slots,"cnpj",{class:"nome"},void 0,!0)]),_:3}),n(s,{span:4},{default:i(()=>[b(e.$slots,"vml",{},void 0,!0)]),_:3}),n(s,{span:3},{default:i(()=>[b(e.$slots,"data",{},void 0,!0)]),_:3}),n(s,{span:4},{default:i(()=>[p("div",null,[n(o,{icon:j,onClick:a[1]||(a[1]=r=>e.$props.actionView(e.$props.data))},{default:i(()=>[Q]),_:1}),n(o,{icon:D(M),onClick:a[2]||(a[2]=r=>e.$props.actionDownload(e.$props.data))},{default:i(()=>[W]),_:1},8,["icon"])])]),_:1})]),_:3})}}}),x=C(Y,[["__scopeId","data-v-b99cb41c"]]);const ee={class:"datepicker"},te={watch:{range:{deep:!0,handler({start:s,end:l}){var a=new Date(s);a.setUTCHours(0,0,0,0),a.setUTCDate(a.getUTCDate());var s=a.toISOString(),o=new Date(l);o.setUTCHours(0,0,0,0),o.setUTCDate(o.getUTCDate());var l=o.toISOString();this.$props.changeDates({start:s,end:l},!0)}}},props:{changeDates:{type:Function,default:()=>{}}},data(){var t=new Date;return t.setDate(t.getDate()-5),{range:{start:t,end:new Date},selectedColor:"teal"}}},ae=Object.assign(te,{__name:"VmlCalendario",setup(t){return(e,a)=>{const s=h("VDatePicker");return g(),f("div",ee,[n(s,{modelValue:e.range,"onUpdate:modelValue":a[0]||(a[0]=o=>e.range=o),modelModifiers:{range:!0},color:e.selectedColor,attributes:e.attributes,borderless:"",transparent:""},null,8,["modelValue","color","attributes"])])}}});const se=t=>(A("data-v-cf66204b"),t=t(),U(),t),oe={class:"container-vml"},le={class:"vml-lista-container"},ne={class:"calendario"},ie={class:"lista"},re={key:0,class:"pagination"},de={class:"items-pagination"},ce={id:"images"},ue=["src"],me=se(()=>p("span",{class:"dialog-footer"},[p("div",{class:"container-bt-imprimir"})],-1)),pe={data:()=>({user:JSON.parse(sessionStorage.getItem("user")),vmls:[],starDate:new Date,endDate:new Date,registros:10,pagina:1,totalPaginas:null,selects:[],selectedBusiness:[],dialogVisible:!1,imgView:null,listaClientes:[],loading:!0,idgruposclientes:null,imagens:null}),created(){this.mountGrid()},watch:{endDate(){this.pagina=1,this.mountGrid()}},methods:{formatData:t=>new Date(t).toLocaleString([],{dateStyle:"short"}),setPage(t){this.selects=[],this.pagina=t,this.mountGrid()},catchDefault(t){console.error(t),this.setLoading(!1)},async ViewAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=new H;this.setLoading(!0);let a=0;await this.selects.reduce(async(s,o,l)=>{await s,o.lstPathImagem.length>0?await o.lstPathImagem.reduce(async(r,c)=>{await _.get(t+c.pathImage,{responseType:"blob"}).then(()=>{var u=new Image;u.src=t+c.pathImage,e.addImage(u,"GIF",10,5,0,100),e.addPage(),a++}).catch(this.catchDefault)},Promise.resolve()):await _.get(t+o.pathImagem,{responseType:"blob"}).then(()=>{var r=new Image;r.src=t+o.pathImagem,l!=0&&e.addPage(),e.addImage(r,"GIF",10,5,130,100),a++}).catch(this.catchDefault)},Promise.resolve()),this.setLoading(!1),a>0?window.open(e.output("bloburl")):w.alert("Nenhuma imagem encontrada","VML")},async downloadAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=S(),a=[];if(this.setLoading(!0),await this.selects.reduce(async(s,o)=>{await s,o.lstPathImagem.length>0?await o.lstPathImagem.reduce(async(l,r)=>{await l,await _.get(t+r.pathImage,{responseType:"blob"}).then(c=>{var u=new Blob([c.data],{type:"image/gif"});a.push({name:r.pathImage,file:u})}).catch(this.catchDefault)},Promise.resolve()):await _.get(t+o.pathImagem,{responseType:"blob"}).then(l=>{var r=new Blob([l.data],{type:"image/gif"});a.push({name:o.pathImagem,file:r})}).catch(this.catchDefault)},Promise.resolve()),a.length<1){this.setLoading(!1),w.alert("Nenhuma imagem encontrada","VML");return}a.forEach(s=>{e.file(s.name,s.file)}),e.generateAsync({type:"blob"}).then(s=>{const o=new Blob([s]);this.setLoading(!1),T(o,"VMLsPortalMultilixo.zip")})},async downloadItem(t){if(this.setLoading(!0),t.lstPathImagem.length>0){const a="https://portalmultilixo.blob.core.windows.net/portalmultilixo",s=S(),o=[];if(await t.lstPathImagem.reduce(async(l,r)=>{await l,await _.get(a+r.pathImage,{responseType:"blob"}).then(c=>{var u=new Blob([c.data],{type:"image/gif"});o.push({name:r.pathImage,file:u})}).catch(this.catchDefault)},Promise.resolve()),o.length<1){this.setLoading(!1),w.alert("Nenhuma imagem encontrada","VML");return}o.forEach(l=>{s.file(l.name,l.file)}),s.generateAsync({type:"blob"}).then(l=>{const r=new Blob([l]);T(r,"VMLsPortalMultilixo.zip"),this.setLoading(!1)});return}const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo";if(t.lstPathImagem.length>0){const a=[];t.lstPathImagem.forEach(s=>{a.push({src:e+s.pathImage})}),this.imagens=a,this.dialogVisible=!0;return}this.setLoading(!0),_.get(e+t.pathImagem,{responseType:"blob"}).then(a=>{var s=new Blob([a.data],{type:"image/gif"}),o=URL.createObjectURL(s);window.open(o)}).catch(a=>{console.error(a),a.response.status==404&&w.alert("Nenhuma imagem encontrada","VML")}).finally(()=>{this.setLoading(!1)})},changeFilterBusiness(t){t?this.selectedBusiness=[t]:this.selectedBusiness=[]},changeDates({start:t,end:e}){this.starDate=t,this.endDate=e,this.selects=[]},selectItem(t,e){e?this.selects.push(t):this.selects=this.selects.filter(a=>a!=t)},setLoading(t){const e=O.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close()},mountGrid(t){if(t&&this.pagina!=1){this.pagina=t,this.totalPaginas=t;return}const{idGruposClientes:e,role:a,id:s}=this.user,{pagina:o,registros:l,selectedBusiness:r,__API:c,setLoading:u}=this;u(!0);let d=null;a=="Admin"?d=`${c}/Cliente/grupo/`+e:d=`${c}/Usuario/acessos/`+s,B.Get(d).then(F=>{const I={vrl:0,pagina:o,registros:l,datainicial:this.starDate,datafinal:this.endDate,idgruposclientes:e,versao:2,listaclientes:F.data};r.length>0?I.listaclientes=r:a=="Admin"&&(I.listaclientes=[]),B.Post(`${c}/Vrls/periodo`,I).then(L=>{this.totalPaginas=L.data.total_registros,this.vmls=L.data.registros,u(!1)}).catch(()=>{u(!1),this.vmls=[]})})}}},ge=Object.assign(pe,{__name:"VmlLista",setup(t){return(e,a)=>{const s=h("el-button"),o=h("el-button-group"),l=h("el-col"),r=h("el-row"),c=h("el-pagination"),u=h("el-dialog");return g(),f(V,null,[n(J,{title:"Ordens de servico VML"}),n(q,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#F08327"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes"]),p("div",oe,[p("div",le,[p("div",ne,[n(o,{class:"button-download-container"},{default:i(()=>[n(s,{icon:D(M),class:P({"":!0,"button-download-active":e.selects.length>0}),disabled:e.selects.length==0,onClick:a[0]||(a[0]=d=>e.downloadAllSelected())},{default:i(()=>[m(" Download ")]),_:1},8,["icon","class","disabled"]),n(s,{icon:D(E),class:P({"":!0,"button-download-active":e.selects.length>0}),disabled:e.selects.length==0,onClick:a[1]||(a[1]=d=>e.ViewAllSelected())},{default:i(()=>[m("Visualizar ")]),_:1},8,["icon","class","disabled"])]),_:1}),n(ae,{changeDates:e.changeDates},null,8,["changeDates"])]),p("div",ie,[n(r,{class:"lista-header"},{default:i(()=>[n(l,{span:1}),n(l,{span:3},{default:i(()=>[m("Cliente")]),_:1}),n(l,{span:9},{default:i(()=>[m("Nome")]),_:1}),n(l,{span:4},{default:i(()=>[m("VML")]),_:1}),n(l,{span:4},{default:i(()=>[m("Data")]),_:1}),n(l,{span:3},{default:i(()=>[m("Ações")]),_:1})]),_:1}),(g(!0),f(V,null,$(e.vmls,d=>(g(),y(x,{selectItem:e.selectItem,idVrls:d.idVrls,actionDownload:e.downloadItem,actionView:e.viewItem,data:d,selects:e.selects},{codCliente:i(()=>[m(v(d.codigoCliente),1)]),cnpj:i(()=>[m(v(d.nomeLocal!=""?d.nomeLocal:d.nome),1)]),vml:i(()=>[m(v(d.vrl),1)]),data:i(()=>[m(v(e.formatData(d.dataChamada)),1)]),_:2},1032,["selectItem","idVrls","actionDownload","actionView","data","selects"]))),256)),e.vmls.length===0?(g(),y(R,{key:0,message:"Nenhum VML encontrado"})):k("",!0)])]),e.vmls.length>0?(g(),f("div",re,[p("div",de,[n(c,{small:"",background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":a[2]||(a[2]=d=>e.page=d),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):k("",!0)]),n(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=d=>e.dialogVisible=d),width:"80%"},{footer:i(()=>[me]),default:i(()=>[p("div",ce,[(g(!0),f(V,null,$(e.imagens,d=>(g(),f("img",{src:d.src,alt:"Imagem nao encontrada",style:{width:"100%","margin-top":"40px"}},null,8,ue))),256))])]),_:1},8,["modelValue"])],64)}}}),he=C(ge,[["__scopeId","data-v-cf66204b"]]);const fe={__name:"VmlView",setup(t){return(e,a)=>(g(),f(V,null,[n(Z,null,{titulo:i(()=>[m("Ordens de serviço VML")]),_:1}),n(he)],64))}},Pe=C(fe,[["__scopeId","data-v-6601bccf"]]);export{Pe as default};
