import{c as b}from"./controllerbase-f6de9c04.js";import{V as k,T as G,a as S,E as L}from"./VisualizarArquivoVml-c41b2585.js";import{_ as v,r as _,o as u,i as f,w as s,b as a,j as m,a as c,c as h,f as r,F as C,k as N,d as V,E as M,t as g,p as j,g as O}from"./index-d204a6cb.js";import{a as A}from"./axios-4a70c6fc.js";const E={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)}}},q=Object.assign(E,{__name:"RelatorioItem",setup(t){return(e,n)=>{const o=_("el-col"),l=_("el-button"),d=_("el-row");return u(),f(d,null,{default:s(()=>[a(o,{span:3},{default:s(()=>[m(e.$slots,"codigocliente",{class:"nome"},void 0,!0)]),_:3}),a(o,{span:7},{default:s(()=>[m(e.$slots,"nome",{class:"nome"},void 0,!0)]),_:3}),a(o,{span:7},{default:s(()=>[m(e.$slots,"descricaoDocumento",{class:"nome"},void 0,!0)]),_:3}),a(o,{span:5},{default:s(()=>[m(e.$slots,"periodo",{},void 0,!0)]),_:3}),a(o,{span:1},{default:s(()=>[c("div",null,[a(l,{icon:k,onClick:n[0]||(n[0]=i=>e.$props.actionView(e.$props.data))})])]),_:1})]),_:3})}}}),T=v(q,[["__scopeId","data-v-777c9c82"]]);const U={class:"container-vml"},z={class:"vml-lista-container"},Y={class:"lista"},H={key:0,class:"pagination"},J={class:"items-pagination"},K={data:()=>({user:JSON.parse(localStorage.getItem("user")),vmls:[],registros:10,pagina:1,totalPaginas:null,selectedBusiness:[],loading:!0,idgruposclientes:null,periodoInicial:new Date,periodoFinal:new Date}),created(){this.mountGrid()},watch:{pagina(){this.mountGrid()},endDate(){this.mountGrid()}},methods:{formatData:t=>`${t.substr(4,6)} /  ${t.substr(0,4)}`,setPage(t){this.pagina=t},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem,n={responseType:"blob"};A.get(e,n).then(o=>{var l=new Blob([o.data],{type:"application/pdf"}),d=URL.createObjectURL(l);window.open(d)})},changeFilterBusiness(t){t?this.selectedBusiness=[t]:this.selectedBusiness=[]},changePeriodoControl({start:t,end:e}){this.periodoInicial=t,this.periodoFinal=e},setLoading(t){const e=M.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close()},mountGrid(){const{idGruposClientes:t,role:e}=this.user,{selectedBusiness:n,__API:o,setLoading:l,periodoInicial:d,periodoFinal:i,registros:I,pagina:$}=this,y=("0"+parseInt(d.getMonth()+1)).slice(-2),P=("0"+parseInt(i.getMonth()+1)).slice(-2),F=`${d.getFullYear()}${y}`,R=`${i.getFullYear()}${P}`;var p={periodoinicial:F,periodofinal:R,registros:I,pagina:$};l(!0),b.Get(`${o}/Cliente/grupo/`+t).then(B=>{const D=B.data;n.length>0?p=Object.assign(p,{idgruposclientes:n.idGrupoClientes,idclientes:n.idClientes,listaclientes:n}):(p=Object.assign(p,{idGruposClientes:t,listaclientes:D}),e=="Admin"&&(p.listaclientes=[])),b.Post(`${o}/Medicao/periodo`,p).then(w=>{this.totalPaginas=w.data.total_registros,this.vmls=w.data.registros,l(!1)}).catch(()=>{l(!1),this.vmls=[]})})}}},Q=Object.assign(K,{__name:"RelatorioMedicao",setup(t){return(e,n)=>{const o=_("el-col"),l=_("el-row"),d=_("el-pagination");return u(),h(C,null,[a(G,{title:"Relatórios"}),a(S,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#543976",showPeriodoControl:!0,changePeriodoControl:e.changePeriodoControl},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes","changePeriodoControl"]),c("div",U,[c("div",z,[c("div",Y,[a(l,null,{default:s(()=>[a(o,{span:3},{default:s(()=>[r("Cod. Cliente")]),_:1}),a(o,{span:7},{default:s(()=>[r("Nome")]),_:1}),a(o,{span:7},{default:s(()=>[r("Descricao Documento")]),_:1}),a(o,{span:5},{default:s(()=>[r("Periodo")]),_:1}),a(o,{span:1},{default:s(()=>[r("Ações")]),_:1})]),_:1}),(u(!0),h(C,null,N(e.vmls,i=>(u(),f(T,{idVrls:i.idVrls,actionView:e.viewItem,data:i},{codigocliente:s(()=>[r(g(i.codigoCliente),1)]),nome:s(()=>[r(g(i.nome),1)]),descricaoDocumento:s(()=>[r(g(i.descricaoDocumento),1)]),periodo:s(()=>[r(g(e.formatData(i.periodo)),1)]),_:2},1032,["idVrls","actionView","data"]))),256)),e.vmls.length===0?(u(),f(L,{key:0,message:"Nenhum VML encontrado"})):V("",!0)])]),e.vmls.length>0?(u(),h("div",H,[c("div",J,[a(d,{background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":n[0]||(n[0]=i=>e.page=i),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):V("",!0)])],64)}}}),W=v(Q,[["__scopeId","data-v-6ac89a57"]]);const X=t=>(j("data-v-739a9a0f"),t=t(),O(),t),Z=X(()=>c("div",{class:"breadcumbs"},[c("div",{class:"home"},"Home"),c("div",{class:"ordens-service-vml"},"Relatórios")],-1)),x={__name:"RelatorioView",setup(t){return(e,n)=>(u(),h("div",null,[Z,c("div",null,[a(W)])]))}},ae=v(x,[["__scopeId","data-v-739a9a0f"]]);export{ae as default};
