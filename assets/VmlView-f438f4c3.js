import{_ as D,r as h,o as g,j as I,w as i,b as n,k as w,e as M,a as c,l as E,u as y,m as F,p as C,g as $,c as _,z as T,n as k,f as m,A as N,F as V,i as S,d as L,E as B,t as b}from"./index-57be42c9.js";import{V as O,J as z,d as A}from"./file-download-f42a9c19.js";import{c as U}from"./controllerbase-3b2baa9b.js";import{_ as j}from"./VmlPesquisa-afffce26.js";import{T as q,E as H}from"./EmptyState-15d436fc.js";import{a as f}from"./axios-4a70c6fc.js";import{E as J}from"./jspdf.es.min-a548e6e7.js";const G=t=>(C("data-v-b99cb41c"),t=t(),$(),t),R=["value"],Z=G(()=>c("div",{class:"texto-botao"},"Visualizar",-1)),K=G(()=>c("div",{class:"texto-botao"},"Download",-1)),Q={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},selects:{type:Array,default:()=>[]},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)},selects(t){t.length===0&&(this.selected=!1)}},methods:{zerarCheckboxes(){}}},W=Object.assign(Q,{__name:"VmlItem",setup(t){return(e,a)=>{const o=h("el-col"),l=h("el-button"),s=h("el-row");return g(),I(s,null,{default:i(()=>[n(o,{span:1},{default:i(()=>[w(e.$slots,"check",{class:"nome"},()=>[M(c("input",{type:"checkbox",value:e.selected,"onUpdate:modelValue":a[0]||(a[0]=d=>e.selected=d)},null,8,R),[[E,e.selected]])],!0)]),_:3}),n(o,{span:3},{default:i(()=>[w(e.$slots,"codCliente",{class:"nome"},void 0,!0)]),_:3}),n(o,{span:9},{default:i(()=>[w(e.$slots,"cnpj",{class:"nome"},void 0,!0)]),_:3}),n(o,{span:4},{default:i(()=>[w(e.$slots,"vml",{},void 0,!0)]),_:3}),n(o,{span:3},{default:i(()=>[w(e.$slots,"data",{},void 0,!0)]),_:3}),n(o,{span:4},{default:i(()=>[c("div",null,[n(l,{icon:O,onClick:a[1]||(a[1]=d=>e.$props.actionView(e.$props.data))},{default:i(()=>[Z]),_:1}),n(l,{icon:y(F),onClick:a[2]||(a[2]=d=>e.$props.actionDownload(e.$props.data))},{default:i(()=>[K]),_:1},8,["icon"])])]),_:1})]),_:3})}}}),X=D(W,[["__scopeId","data-v-b99cb41c"]]);const Y={class:"datepicker"},x={watch:{range:{deep:!0,handler({start:t,end:e}){if((t-e)/(1e3*60*60*24)*-1>30)T({showClose:!0,message:"Náo é possível selecionar um periodo maior que 30 dias.",type:"warning"});else{var l=new Date(t);l.setUTCHours(0,0,0,0),l.setUTCDate(l.getUTCDate());var t=l.toISOString(),s=new Date(e);s.setUTCHours(0,0,0,0),s.setUTCDate(s.getUTCDate());var e=s.toISOString();this.$props.changeDates({start:t,end:e},!0)}}}},props:{changeDates:{type:Function,default:()=>{}}},data(){var t=new Date;return t.setDate(t.getDate()-5),{range:{start:t,end:new Date},selectedColor:"teal"}}},ee=Object.assign(x,{__name:"VmlCalendario",setup(t){return(e,a)=>{const o=h("VDatePicker");return g(),_("div",Y,[n(o,{modelValue:e.range,"onUpdate:modelValue":a[0]||(a[0]=l=>e.range=l),modelModifiers:{range:!0},color:e.selectedColor,attributes:e.attributes,borderless:"",transparent:""},null,8,["modelValue","color","attributes"])])}}});const te=t=>(C("data-v-7d83b1aa"),t=t(),$(),t),ae={class:"container-vml"},se={class:"vml-lista-container"},oe={class:"calendario"},le={class:"lista"},ne={key:0,class:"pagination"},ie={class:"items-pagination"},re={id:"images"},de=["src"],ce=te(()=>c("span",{class:"dialog-footer"},[c("div",{class:"container-bt-imprimir"})],-1)),ue={data:()=>({user:JSON.parse(localStorage.getItem("user")),vmls:[],starDate:new Date,endDate:new Date,registros:10,pagina:1,totalPaginas:null,selects:[],selectedBusiness:[],dialogVisible:!1,imgView:null,listaClientes:[],loading:!0,idgruposclientes:null,imagens:null}),created(){this.mountGrid()},watch:{pagina(){this.mountGrid()},endDate(){this.mountGrid()}},methods:{formatData:t=>new Date(t).toLocaleString([],{dateStyle:"short"}),setPage(t){this.selects=[],this.pagina=t},async ViewAllSelected(){const t="https://portalmultilixo.blob.core.windows.net/portalmultilixo",e=new J;await this.selects.reduce(async(a,o,l)=>{await a,o.lstPathImagem.length>0?await this.selects.reduce(async(s,d)=>{await d.lstPathImagem.reduce(async(u,p)=>{await f.get(t+p.pathImage,{responseType:"blob"}).then(()=>{var r=new Image;r.src=t+p.pathImage,e.addImage(r,"GIF",10,5,130,100),e.addPage()})})},Promise.resolve()):await f.get(t+o.pathImagem,{responseType:"blob"}).then(()=>{var s=new Image;s.src=t+o.pathImagem,l!=0&&e.addPage(),e.addImage(s,"GIF",10,5,130,100)})},Promise.resolve()),window.open(e.output("bloburl"))},async downloadAllSelected(){const t=B.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"}),e="https://portalmultilixo.blob.core.windows.net/portalmultilixo",a=z(),o=[];await this.selects.reduce(async(l,s)=>{await l,s.lstPathImagem.length>0?await s.lstPathImagem.reduce(async(d,u)=>{await d,await f.get(e+u.pathImage,{responseType:"blob"}).then(p=>{var r=new Blob([p.data],{type:"image/gif"});o.push({name:u.pathImage,file:r})})},Promise.resolve()):await f.get(e+s.pathImagem,{responseType:"blob"}).then(d=>{var u=new Blob([d.data],{type:"image/gif"});o.push({name:s.pathImagem,file:u})})},Promise.resolve()),o.forEach(l=>{a.file(l.name,l.file)}),a.generateAsync({type:"blob"}).then(l=>{const s=new Blob([l]);t.close(),setTimeout(()=>{A(s,"VMLsPortalMultilixo.zip")},1e3)})},async downloadItem(t){if(this.setLoading(!0),t.lstPathImagem.length>0){const a="https://portalmultilixo.blob.core.windows.net/portalmultilixo",o=z(),l=[];await t.lstPathImagem.reduce(async(s,d)=>{await s,await f.get(a+d.pathImage,{responseType:"blob"}).then(u=>{var p=new Blob([u.data],{type:"image/gif"});l.push({name:d.pathImage,file:p})})},Promise.resolve()),l.forEach(s=>{o.file(s.name,s.file)}),o.generateAsync({type:"blob"}).then(s=>{const d=new Blob([s]);A(d,"VMLsPortalMultilixo.zip"),this.setLoading(!1)});return}const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem;window.open(e,"_blank")},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo";if(t.lstPathImagem.length>0){const a=[];t.lstPathImagem.forEach(o=>{a.push({src:e+o.pathImage})}),this.imagens=a,this.dialogVisible=!0;return}f.get(e+t.pathImagem,{responseType:"blob"}).then(a=>{var o=new Blob([a.data],{type:"image/gif"}),l=URL.createObjectURL(o);window.open(l)})},changeFilterBusiness(t){t?this.selectedBusiness=[t]:this.selectedBusiness=[]},changeDates({start:t,end:e}){this.starDate=t,this.endDate=e},selectItem(t,e){e?this.selects.push(t):this.selects=this.selects.filter(a=>a!=t)},setLoading(t){const e=B.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close(),this.selects=[]},mountGrid(){const{idGruposClientes:t,role:e,id:a}=this.user,{pagina:o,registros:l,selectedBusiness:s,__API:d,setLoading:u}=this;u(!0);let p=null;e=="Admin"?p=`${d}/Cliente/grupo/`+t:p=`${d}/Usuario/acessos/`+a,U.Get(p).then(r=>{const v={vrl:0,pagina:o,registros:l,datainicial:this.starDate,datafinal:this.endDate,idgruposclientes:t,versao:2,listaclientes:r.data};s.length>0?v.listaclientes=s:e=="Admin"&&(v.listaclientes=[]),U.Post(`${d}/Vrls/periodo`,v).then(P=>{this.totalPaginas=P.data.total_registros,this.vmls=P.data.registros,u(!1)}).catch(()=>{u(!1),this.vmls=[]})})}}},pe=Object.assign(ue,{__name:"VmlLista",setup(t){return(e,a)=>{const o=h("el-button"),l=h("el-button-group"),s=h("el-col"),d=h("el-row"),u=h("el-pagination"),p=h("el-dialog");return g(),_(V,null,[n(q,{title:"Ordens de servico VML"}),n(j,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#F08327"},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes"]),c("div",ae,[c("div",se,[c("div",oe,[n(l,{class:"button-download-container"},{default:i(()=>[n(o,{icon:y(F),class:k({"":!0,"button-download-active":e.selects.length>0}),disabled:e.selects.length==0,onClick:a[0]||(a[0]=r=>e.downloadAllSelected())},{default:i(()=>[m(" Download ")]),_:1},8,["icon","class","disabled"]),n(o,{icon:y(N),class:k({"":!0,"button-download-active":e.selects.length>0}),disabled:e.selects.length==0,onClick:a[1]||(a[1]=r=>e.ViewAllSelected())},{default:i(()=>[m("Visualizar ")]),_:1},8,["icon","class","disabled"])]),_:1}),n(ee,{changeDates:e.changeDates},null,8,["changeDates"])]),c("div",le,[n(d,{class:"lista-header"},{default:i(()=>[n(s,{span:1}),n(s,{span:3},{default:i(()=>[m("Cliente")]),_:1}),n(s,{span:9},{default:i(()=>[m("Nome")]),_:1}),n(s,{span:4},{default:i(()=>[m("VML")]),_:1}),n(s,{span:4},{default:i(()=>[m("Data")]),_:1}),n(s,{span:3},{default:i(()=>[m("Ações")]),_:1})]),_:1}),(g(!0),_(V,null,S(e.vmls,r=>(g(),I(X,{selectItem:e.selectItem,idVrls:r.idVrls,actionDownload:e.downloadItem,actionView:e.viewItem,data:r,selects:e.selects},{codCliente:i(()=>[m(b(r.codigoCliente),1)]),cnpj:i(()=>[m(b(r.nomeLocal!=""?r.nomeLocal:r.nome),1)]),vml:i(()=>[m(b(r.vrl),1)]),data:i(()=>[m(b(e.formatData(r.dataChamada)),1)]),_:2},1032,["selectItem","idVrls","actionDownload","actionView","data","selects"]))),256)),e.vmls.length===0?(g(),I(H,{key:0,message:"Nenhum VML encontrado"})):L("",!0)])]),e.vmls.length>0?(g(),_("div",ne,[c("div",ie,[n(u,{small:"",background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":a[2]||(a[2]=r=>e.page=r),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):L("",!0)]),n(p,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=r=>e.dialogVisible=r),width:"80%"},{footer:i(()=>[ce]),default:i(()=>[c("div",re,[(g(!0),_(V,null,S(e.imagens,r=>(g(),_("img",{src:r.src,alt:"",style:{width:"100%","margin-top":"40px"}},null,8,de))),256))])]),_:1},8,["modelValue"])],64)}}}),me=D(pe,[["__scopeId","data-v-7d83b1aa"]]);const ge=t=>(C("data-v-f2ea29d1"),t=t(),$(),t),he={style:{"padding-top":"25px"}},_e=ge(()=>c("div",{class:"breadcumbs"},[c("div",{class:"home"},"Home"),c("div",{class:"ordens-service-vml"},"Ordens de serviço VML")],-1)),fe={__name:"VmlView",setup(t){return(e,a)=>(g(),_("div",he,[_e,c("div",null,[n(me)])]))}},Ce=D(fe,[["__scopeId","data-v-f2ea29d1"]]);export{Ce as default};
