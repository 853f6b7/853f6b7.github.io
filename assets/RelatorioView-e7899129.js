import{c as b}from"./controllerbase-f6de9c04.js";import{V as S,T as L,a as N,E as M}from"./VisualizarArquivoVml-5d625bd3.js";import{_ as v,r as _,o as u,i as f,w as o,b as a,j as m,a as l,p as I,g as $,c as h,f as d,F as V,k as j,d as C,E as O,t as g}from"./index-103c12ce.js";import{a as A}from"./axios-4a70c6fc.js";const E=t=>(I("data-v-063c0db4"),t=t(),$(),t),q=E(()=>l("div",{class:"texto-botao"},"Visualizar",-1)),z={data:()=>({selected:!1}),props:{selectItem:{type:Function,default:()=>{}},idVrls:{type:Number},actionDownload:{type:Function,default:()=>{}},actionView:{type:Function,default:()=>{}},data:{type:Array,default:[]}},watch:{selected(){this.$props.selectItem(this.$props.data,this.selected)}}},T=Object.assign(z,{__name:"RelatorioItem",setup(t){return(e,i)=>{const s=_("el-col"),r=_("el-button"),c=_("el-row");return u(),f(c,null,{default:o(()=>[a(s,{span:3},{default:o(()=>[m(e.$slots,"codigocliente",{class:"nome"},void 0,!0)]),_:3}),a(s,{span:7},{default:o(()=>[m(e.$slots,"nome",{class:"nome"},void 0,!0)]),_:3}),a(s,{span:7},{default:o(()=>[m(e.$slots,"descricaoDocumento",{class:"nome"},void 0,!0)]),_:3}),a(s,{span:5},{default:o(()=>[m(e.$slots,"periodo",{},void 0,!0)]),_:3}),a(s,{span:1},{default:o(()=>[l("div",null,[a(r,{icon:S,onClick:i[0]||(i[0]=n=>e.$props.actionView(e.$props.data))},{default:o(()=>[q]),_:1})])]),_:1})]),_:3})}}}),U=v(T,[["__scopeId","data-v-063c0db4"]]);const Y={class:"container-vml"},H={class:"vml-lista-container"},J={class:"lista"},K={key:0,class:"pagination"},Q={class:"items-pagination"},W={data:()=>({user:JSON.parse(localStorage.getItem("user")),vmls:[],registros:10,pagina:1,totalPaginas:null,selectedBusiness:[],loading:!0,idgruposclientes:null,periodoInicial:new Date,periodoFinal:new Date}),created(){this.mountGrid()},watch:{pagina(){this.mountGrid()},endDate(){this.mountGrid()}},methods:{formatData:t=>`${t.substr(4,6)} /  ${t.substr(0,4)}`,setPage(t){this.pagina=t},viewItem(t){const e="https://portalmultilixo.blob.core.windows.net/portalmultilixo"+t.pathImagem,i={responseType:"blob"};A.get(e,i).then(s=>{var r=new Blob([s.data],{type:"application/pdf"}),c=URL.createObjectURL(r);window.open(c)})},changeFilterBusiness(t){t?this.selectedBusiness=[t]:this.selectedBusiness=[]},changePeriodoControl({start:t,end:e}){this.periodoInicial=t,this.periodoFinal=e},setLoading(t){const e=O.service({lock:!0,text:"Carregando...",background:"rgba(0, 0, 0, 0.7)"});t||e.close()},mountGrid(){const{idGruposClientes:t,role:e}=this.user,{selectedBusiness:i,__API:s,setLoading:r,periodoInicial:c,periodoFinal:n,registros:y,pagina:P}=this,F=("0"+parseInt(c.getMonth()+1)).slice(-2),R=("0"+parseInt(n.getMonth()+1)).slice(-2),B=`${c.getFullYear()}${F}`,D=`${n.getFullYear()}${R}`;var p={periodoinicial:B,periodofinal:D,registros:y,pagina:P};r(!0),b.Get(`${s}/Cliente/grupo/`+t).then(k=>{const G=k.data;i.length>0?p=Object.assign(p,{idgruposclientes:i.idGrupoClientes,idclientes:i.idClientes,listaclientes:i}):(p=Object.assign(p,{idGruposClientes:t,listaclientes:G}),e=="Admin"&&(p.listaclientes=[])),b.Post(`${s}/Medicao/periodo`,p).then(w=>{this.totalPaginas=w.data.total_registros,this.vmls=w.data.registros,r(!1)}).catch(()=>{r(!1),this.vmls=[]})})}}},X=Object.assign(W,{__name:"RelatorioMedicao",setup(t){return(e,i)=>{const s=_("el-col"),r=_("el-row"),c=_("el-pagination");return u(),h(V,null,[a(L,{title:"Relatórios"}),a(N,{changeFilterBusiness:e.changeFilterBusiness,Pesquisar:e.mountGrid,idGrupoClientes:e.idgruposclientes,background:"#543976",showPeriodoControl:!0,changePeriodoControl:e.changePeriodoControl},null,8,["changeFilterBusiness","Pesquisar","idGrupoClientes","changePeriodoControl"]),l("div",Y,[l("div",H,[l("div",J,[a(r,{class:"lista-header"},{default:o(()=>[a(s,{span:3},{default:o(()=>[d("Cod. Cliente")]),_:1}),a(s,{span:7},{default:o(()=>[d("Nome")]),_:1}),a(s,{span:7},{default:o(()=>[d("Descricao Documento")]),_:1}),a(s,{span:5},{default:o(()=>[d("Periodo")]),_:1}),a(s,{span:1},{default:o(()=>[d("Ações")]),_:1})]),_:1}),(u(!0),h(V,null,j(e.vmls,n=>(u(),f(U,{idVrls:n.idVrls,actionView:e.viewItem,data:n},{codigocliente:o(()=>[d(g(n.codigoCliente),1)]),nome:o(()=>[d(g(n.nome),1)]),descricaoDocumento:o(()=>[d(g(n.descricaoDocumento),1)]),periodo:o(()=>[d(g(e.formatData(n.periodo)),1)]),_:2},1032,["idVrls","actionView","data"]))),256)),e.vmls.length===0?(u(),f(M,{key:0,message:"Nenhum VML encontrado"})):C("",!0)])]),e.vmls.length>0?(u(),h("div",K,[l("div",Q,[a(c,{background:"",layout:"prev, pager, next",total:e.totalPaginas,modelValue:e.page,"onUpdate:modelValue":i[0]||(i[0]=n=>e.page=n),onCurrentChange:e.setPage,"page-size":e.registros},null,8,["total","modelValue","onCurrentChange","page-size"])])])):C("",!0)])],64)}}}),Z=v(X,[["__scopeId","data-v-e441584c"]]);const x=t=>(I("data-v-739a9a0f"),t=t(),$(),t),ee=x(()=>l("div",{class:"breadcumbs"},[l("div",{class:"home"},"Home"),l("div",{class:"ordens-service-vml"},"Relatórios")],-1)),te={__name:"RelatorioView",setup(t){return(e,i)=>(u(),h("div",null,[ee,l("div",null,[a(Z)])]))}},ne=v(te,[["__scopeId","data-v-739a9a0f"]]);export{ne as default};
